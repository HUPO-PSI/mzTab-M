name: Validate mzTab-M Files version 2.0.0

on:
  push:
    branches:
      - main
    paths:
      - 'examples/**'
  pull_request:
    branches:
      - main
    paths:
      - 'examples/**'
  workflow_dispatch:

jobs:
  setup:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
      
  LoadCodeBase:
    runs-on: ubuntu-latest
    needs: setup
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Print Java version from setup
        run: echo "Using Java 17"

      - name: Download jmzTab-m CLI
        id: download_cli
        run: |
          VERSION="1.0.6"
          CLI_URL="https://repo1.maven.org/maven2/de/isas/mztab/jmztabm-cli/${VERSION}/jmztabm-cli-${VERSION}.jar"

          echo "Downloading jmzTab-m CLI version ${VERSION}..."
          wget -q "${CLI_URL}" -O jmztabm-cli-${VERSION}.jar

          echo "Downloaded jmzTab-m CLI jar: jmztabm-cli-${VERSION}.jar"

      - name: Upload CLI jar as artifact
        uses: actions/upload-artifact@v4
        with:
          name: jmztab-cli
          path: jmztabm-cli-*.jar
          
  MetabolightsValidation:
    runs-on: ubuntu-latest
    needs: LoadCodeBase
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download CLI jar
        uses: actions/download-artifact@v4
        with:
          name: jmztab-cli
          path: .

      - name: Verify CLI jar
        run: ls -lh
        
      - name: Validate multiple 'mtbls*' files
        run: |
          CLI_JAR=$(ls jmztabm-cli-*.jar | head -n 1)
          echo "Using CLI jar: $CLI_JAR"

          # Check if any files match the pattern
          FILES=(examples/mtbls*)
          if [ ! -e "${FILES[0]}" ]; then
            echo "::warning title=No files found::No files matching 'examples/mtbls*' were found."
          fi
          
          for file in examples/mtbls*; do
            if [ -f "$file" ]; then
              echo "Validating $file..."
              java -jar "$CLI_JAR" -c "$file" -l Info
              echo "Validation of $file completed!"
            fi
          done

  ManualFilesValidation:
    runs-on: ubuntu-latest
    needs: LoadCodeBase
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download CLI jar
        uses: actions/download-artifact@v4
        with:
          name: jmztab-cli
          path: .

      - name: Verify CLI jar
        run: ls -lh
        
      - name: Validate multiple 'manual*' files
        run: |
          CLI_JAR=$(ls jmztabm-cli-*.jar | head -n 1)
          echo "Using CLI jar: $CLI_JAR"

          # Check if any files match the pattern
          FILES=(examples/manual*)
          if [ ! -e "${FILES[0]}" ]; then
            echo "::warning title=No files found::No files matching 'examples/manual*' were found."
          fi
          
          for file in examples/manual*; do
            if [ -f "$file" ]; then
              echo "Validating $file..."
              java -jar "$CLI_JAR" -c "$file" -l Info
              echo "Validation of $file completed!"
            fi
          done

  MS-DIALValidation:
    runs-on: ubuntu-latest
    needs: LoadCodeBase
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download CLI jar
        uses: actions/download-artifact@v4
        with:
          name: jmztab-cli
          path: .

      - name: Verify CLI jar
        run: ls -lh

      - name: Validate multiple 'msdial*' files
        run: |
          CLI_JAR=$(ls jmztabm-cli-*.jar | head -n 1)
          echo "Using CLI jar: $CLI_JAR"

          # Check if any files match the pattern
          FILES=(examples/msdial*)
          if [ ! -e "${FILES[0]}" ]; then
            echo "::warning title=No files found::No files matching 'examples/msdial*' were found."
          fi
        
          for file in examples/msdial*; do
            if [ -f "$file" ]; then
              echo "Validating $file..."
              java -jar "$CLI_JAR" -c "$file" -l Info
              echo "Validation of $file completed!"
            fi
          done

  MZMINEValidation:
    runs-on: ubuntu-latest
    needs: LoadCodeBase
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download CLI jar
        uses: actions/download-artifact@v4
        with:
          name: jmztab-cli
          path: .

      - name: Verify CLI jar
        run: ls -lh

      - name: Validate multiple 'mzmine*' files
        run: |
          CLI_JAR=$(ls jmztabm-cli-*.jar | head -n 1)
          echo "Using CLI jar: $CLI_JAR"

          # Check if any files match the pattern
          FILES=(examples/mzmine*)
          if [ ! -e "${FILES[0]}" ]; then
            echo "::warning title=No files found::No files matching 'examples/mzmine*' were found."
          fi
        
          for file in examples/mzmine*; do
            if [ -f "$file" ]; then
              echo "Validating $file..."
              java -jar "$CLI_JAR" -c "$file" -l Info
              echo "Validation of $file completed!"
            fi
          done

  AllMZTABFilesValidation:
    runs-on: ubuntu-latest
    needs: LoadCodeBase
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download CLI jar
        uses: actions/download-artifact@v4
        with:
          name: jmztab-cli
          path: .

      - name: Verify CLI jar
        run: ls -lh
        
      - name: Validate all files
        run: |
          CLI_JAR=$(ls jmztabm-cli-*.jar | head -n 1)
          echo "Using CLI jar: $CLI_JAR"

          # Check if any files match the pattern
          FILES=(examples/*.mztab)
          if [ ! -e "${FILES[0]}" ]; then
            echo "::warning title=No files found::No files matching 'examples/*.mztab' were found."
          fi
          
          for file in examples/*.mztab; do
            if [ -f "$file" ]; then
              echo "Validating $file..."
              java -jar "$CLI_JAR" -c "$file" -l Info
              echo "Validation of $file completed!"
            fi
          done

  AllJSONFilesValidation:
    runs-on: ubuntu-latest
    needs: LoadCodeBase
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download CLI jar
        uses: actions/download-artifact@v4
        with:
          name: jmztab-cli
          path: .

      - name: Verify CLI jar
        run: ls -lh
        
      - name: Validate all files
        run: |
          CLI_JAR=$(ls jmztabm-cli-*.jar | head -n 1)
          echo "Using CLI jar: $CLI_JAR"

          # Check if any files match the pattern
          FILES=(examples/*.json)
          if [ ! -e "${FILES[0]}" ]; then
            echo "::warning title=No files found::No files matching 'examples/*.json' were found."
          fi
          
          for file in examples/*.json; do
            if [ -f "$file" ]; then
              echo "Validating $file..."
              java -jar "$CLI_JAR" -c "$file" --fromJson -l Info
              echo "Validation of $file completed!"
            fi
          done
